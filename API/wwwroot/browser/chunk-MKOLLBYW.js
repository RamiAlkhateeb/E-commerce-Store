import{a as se}from"./chunk-CGUWAAPM.js";import{K as vt,L as le,M as Z,N as Ct,O as gt,P as _t,a as mt,b as E,c as H,d as G,h as ut,j as U,k as q,l as z,o as pt,p as ce,t as I,u as ft}from"./chunk-HDRMHIVV.js";import{$a as ie,$b as ht,Aa as p,Ba as h,Ca as $e,Cb as at,Da as Je,Ea as Ke,Fa as m,Ga as s,H as M,Ha as c,I as B,Ia as d,Ib as st,J as Ge,Ja as b,Jb as ct,K as Ue,Ka as x,L as v,La as Y,M as qe,N,O as P,P as Ce,Pa as Se,Q as ge,Qa as xe,Ra as R,Rb as lt,Sa as Te,T as _e,Ta as k,U as ye,Ua as Ee,Ub as dt,Va as u,Xb as re,Y as ze,Yb as ae,Z as Ze,Za as Xe,_a as te,_b as De,a as y,ab as et,b as j,bb as $,da as Qe,db as D,ea as be,eb as l,f as ee,fb as oe,ga as a,gb as O,hb as tt,ib as we,j as F,jb as Fe,kb as T,lb as ne,ma as f,mb as it,oa as g,pa as L,q as Ve,r as He,sa as We,sb as ot,tb as nt,wb as V,xa as ke,xb as rt,ya as W,za as Ye}from"./chunk-2X7YOW7U.js";var yt=["toast-component",""];function Ut(i,n){if(i&1){let e=R();b(0,"button",2),Ee("click",function(){N(e);let o=u();return P(o.remove())}),b(1,"span",3),l(2,"\xD7"),x()()}}function qt(i,n){if(i&1&&(Se(0),l(1),xe()),i&2){let e=u(2);a(),O("[",e.duplicatesCount+1,"]")}}function zt(i,n){if(i&1&&(b(0,"div"),l(1),p(2,qt,2,1,"ng-container"),x()),i&2){let e=u(),t=T(0);D(t.titleClass),W("aria-label",e.title()),a(),O(" ",e.title()," "),a(),h(e.duplicatesCount?2:-1)}}function Zt(i,n){if(i&1&&Y(0,"div",6),i&2){let e=u(2),t=T(0);D(t.messageClass),Te("innerHTML",e.message(),be)}}function Qt(i,n){if(i&1&&(b(0,"div",7),l(1),x()),i&2){let e=u(2),t=T(0);D(t.messageClass),W("aria-label",e.message()),a(),O(" ",e.message()," ")}}function Wt(i,n){if(i&1&&p(0,Zt,1,3,"div",4)(1,Qt,2,4,"div",5),i&2){u();let e=T(0);h(e.enableHtml?0:1)}}function Yt(i,n){if(i&1&&(b(0,"div"),Y(1,"div",8),x()),i&2){let e=u();a(),$("width",e.width()+"%")}}function $t(i,n){if(i&1){let e=R();b(0,"button",2),Ee("click",function(){N(e);let o=u();return P(o.remove())}),b(1,"span",3),l(2,"\xD7"),x()()}}function Jt(i,n){if(i&1&&(Se(0),l(1),xe()),i&2){let e=u(2);a(),O("[",e.duplicatesCount+1,"]")}}function Kt(i,n){if(i&1&&(b(0,"div"),l(1),p(2,Jt,2,1,"ng-container"),x()),i&2){let e=u(),t=T(0);D(t.titleClass),W("aria-label",e.title()),a(),O(" ",e.title()," "),a(),h(e.duplicatesCount?2:-1)}}function Xt(i,n){if(i&1&&Y(0,"div",6),i&2){let e=u(2),t=T(0);D(t.messageClass),Te("innerHTML",e.message(),be)}}function ei(i,n){if(i&1&&(b(0,"div",7),l(1),x()),i&2){let e=u(2),t=T(0);D(t.messageClass),W("aria-label",e.message()),a(),O(" ",e.message()," ")}}function ti(i,n){if(i&1&&p(0,Xt,1,3,"div",4)(1,ei,2,4,"div",5),i&2){u();let e=T(0);h(e.enableHtml?0:1)}}function ii(i,n){if(i&1&&(b(0,"div"),Y(1,"div",8),x()),i&2){let e=u();a(),$("width",e.width()+"%")}}var J=class{toastId;config;message;title;toastType;toastRef;_onTap=new F;_onAction=new F;constructor(n,e,t,o,r,C){this.toastId=n,this.config=e,this.message=t,this.title=o,this.toastType=r,this.toastRef=C,this.toastRef.afterClosed().subscribe(()=>{this._onAction.complete(),this._onTap.complete()})}triggerTap(){this._onTap.next(),this.config.tapToDismiss&&this._onTap.complete()}onTap(){return this._onTap.asObservable()}triggerAction(n){this._onAction.next(n)}onAction(){return this._onAction.asObservable()}},bt={maxOpened:0,autoDismiss:!1,newestOnTop:!0,preventDuplicates:!1,countDuplicates:!1,resetTimeoutOnDuplicate:!1,includeTitleDuplicates:!1,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},closeButton:!1,disableTimeOut:!1,timeOut:5e3,extendedTimeOut:1e3,enableHtml:!1,progressBar:!1,toastClass:"ngx-toastr",positionClass:"toast-top-right",titleClass:"toast-title",messageClass:"toast-message",easing:"ease-in",easeTime:300,tapToDismiss:!0,onActivateTick:!1,progressAnimation:"decreasing"},kt=new Ge("ToastConfig"),Ie=class{_attachedHost;component;viewContainerRef;injector;constructor(n,e){this.component=n,this.injector=e}attach(n,e){return this._attachedHost=n,n.attach(this,e)}detach(){let n=this._attachedHost;if(n)return this._attachedHost=void 0,n.detach()}get isAttached(){return this._attachedHost!=null}setAttachedHost(n){this._attachedHost=n}},Me=class{_attachedPortal;_disposeFn;attach(n,e){return this._attachedPortal=n,this.attachComponentPortal(n,e)}detach(){this._attachedPortal&&this._attachedPortal.setAttachedHost(),this._attachedPortal=void 0,this._disposeFn&&(this._disposeFn(),this._disposeFn=void 0)}setDisposeFn(n){this._disposeFn=n}},Ne=class extends Me{_hostDomElement;_appRef;constructor(n,e){super(),this._hostDomElement=n,this._appRef=e}attachComponentPortal(n,e){let t=at(n.component,{environmentInjector:this._appRef.injector,elementInjector:n.injector});return this._appRef.attachView(t.hostView),this.setDisposeFn(()=>{this._appRef.detachView(t.hostView),t.destroy()}),e?this._hostDomElement.insertBefore(this._getComponentRootNode(t),this._hostDomElement.firstChild):this._hostDomElement.appendChild(this._getComponentRootNode(t)),t}_getComponentRootNode(n){return n.hostView.rootNodes[0]}},oi=(()=>{class i{_document=v(ge);_containerElement;ngOnDestroy(){this._containerElement&&this._containerElement.parentNode&&this._containerElement.parentNode.removeChild(this._containerElement)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let e=this._document.createElement("div");e.classList.add("overlay-container"),e.setAttribute("aria-live","polite"),this._document.body.appendChild(e),this._containerElement=e}static \u0275fac=function(t){return new(t||i)};static \u0275prov=M({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Pe=class{_portalHost;constructor(n){this._portalHost=n}attach(n,e=!0){return this._portalHost.attach(n,e)}detach(){return this._portalHost.detach()}},ni=(()=>{class i{_overlayContainer=v(oi);_appRef=v(ke);_document=v(ge);_paneElements=new Map;create(e,t){return this._createOverlayRef(this.getPaneElement(e,t))}getPaneElement(e="",t){return this._paneElements.get(t)||this._paneElements.set(t,{}),this._paneElements.get(t)[e]||(this._paneElements.get(t)[e]=this._createPaneElement(e,t)),this._paneElements.get(t)[e]}_createPaneElement(e,t){let o=this._document.createElement("div");return o.id="toast-container",o.classList.add(e),o.classList.add("toast-container"),t?t.getContainerElement().appendChild(o):this._overlayContainer.getContainerElement().appendChild(o),o}_createPortalHost(e){return new Ne(e,this._appRef)}_createOverlayRef(e){return new Pe(this._createPortalHost(e))}static \u0275fac=function(t){return new(t||i)};static \u0275prov=M({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Re=class{_overlayRef;componentInstance;duplicatesCount=0;_afterClosed=new F;_activate=new F;_manualClose=new F;_resetTimeout=new F;_countDuplicate=new F;constructor(n){this._overlayRef=n}manualClose(){this._manualClose.next(),this._manualClose.complete()}manualClosed(){return this._manualClose.asObservable()}timeoutReset(){return this._resetTimeout.asObservable()}countDuplicate(){return this._countDuplicate.asObservable()}close(){this._overlayRef.detach(),this._afterClosed.next(),this._manualClose.next(),this._afterClosed.complete(),this._manualClose.complete(),this._activate.complete(),this._resetTimeout.complete(),this._countDuplicate.complete()}afterClosed(){return this._afterClosed.asObservable()}isInactive(){return this._activate.closed}activate(){this._activate.next(),this._activate.complete()}afterActivate(){return this._activate.asObservable()}onDuplicate(n,e){n&&this._resetTimeout.next(),e&&this._countDuplicate.next(++this.duplicatesCount)}},A=(()=>{class i{overlay=v(ni);_injector=v(Ce);sanitizer=v(dt);ngZone=v(_e);toastrConfig;currentlyActive=0;toasts=[];overlayContainer;previousToastMessage;index=0;constructor(){let e=v(kt);this.toastrConfig=y(y({},e.default),e.config),e.config.iconClasses&&(this.toastrConfig.iconClasses=y(y({},e.default.iconClasses),e.config.iconClasses))}show(e,t,o={},r=""){return this._preBuildNotification(r,e,t,this.applyConfig(o))}success(e,t,o={}){let r=this.toastrConfig.iconClasses.success||"";return this._preBuildNotification(r,e,t,this.applyConfig(o))}error(e,t,o={}){let r=this.toastrConfig.iconClasses.error||"";return this._preBuildNotification(r,e,t,this.applyConfig(o))}info(e,t,o={}){let r=this.toastrConfig.iconClasses.info||"";return this._preBuildNotification(r,e,t,this.applyConfig(o))}warning(e,t,o={}){let r=this.toastrConfig.iconClasses.warning||"";return this._preBuildNotification(r,e,t,this.applyConfig(o))}clear(e){for(let t of this.toasts)if(e!==void 0){if(t.toastId===e){t.toastRef.manualClose();return}}else t.toastRef.manualClose()}remove(e){let t=this._findToast(e);if(!t||(t.activeToast.toastRef.close(),this.toasts.splice(t.index,1),this.currentlyActive=this.currentlyActive-1,!this.toastrConfig.maxOpened||!this.toasts.length))return!1;if(this.currentlyActive<this.toastrConfig.maxOpened&&this.toasts[this.currentlyActive]){let o=this.toasts[this.currentlyActive].toastRef;o.isInactive()||(this.currentlyActive=this.currentlyActive+1,o.activate())}return!0}findDuplicate(e="",t="",o,r){let{includeTitleDuplicates:C}=this.toastrConfig;for(let _ of this.toasts){let S=C&&_.title===e;if((!C||S)&&_.message===t)return _.toastRef.onDuplicate(o,r),_}return null}applyConfig(e={}){return y(y({},this.toastrConfig),e)}_findToast(e){for(let t=0;t<this.toasts.length;t++)if(this.toasts[t].toastId===e)return{index:t,activeToast:this.toasts[t]};return null}_preBuildNotification(e,t,o,r){return r.onActivateTick?this.ngZone.run(()=>this._buildNotification(e,t,o,r)):this._buildNotification(e,t,o,r)}_buildNotification(e,t,o,r){if(!r.toastComponent)throw new Error("toastComponent required");let C=this.findDuplicate(o,t,this.toastrConfig.resetTimeoutOnDuplicate&&r.timeOut>0,this.toastrConfig.countDuplicates);if((this.toastrConfig.includeTitleDuplicates&&o||t)&&this.toastrConfig.preventDuplicates&&C!==null)return C;this.previousToastMessage=t;let _=!1;this.toastrConfig.maxOpened&&this.currentlyActive>=this.toastrConfig.maxOpened&&(_=!0,this.toastrConfig.autoDismiss&&this.clear(this.toasts[0].toastId));let S=this.overlay.create(r.positionClass,this.overlayContainer);this.index=this.index+1;let Be=t;t&&r.enableHtml&&(Be=this.sanitizer.sanitize(Qe.HTML,t));let Q=new Re(S),fe=new J(this.index,r,Be,o,e,Q),Vt=[{provide:J,useValue:fe}],Ht=Ce.create({providers:Vt,parent:this._injector}),Gt=new Ie(r.toastComponent,Ht),Le=S.attach(Gt,r.newestOnTop);Q.componentInstance=Le.instance;let ve={toastId:this.index,title:o||"",message:t||"",toastRef:Q,onShown:Q.afterActivate(),onHidden:Q.afterClosed(),onTap:fe.onTap(),onAction:fe.onAction(),portal:Le};return _||(this.currentlyActive=this.currentlyActive+1,setTimeout(()=>{ve.toastRef.activate()})),this.toasts.push(ve),ve}static \u0275fac=function(t){return new(t||i)};static \u0275prov=M({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),ri=(()=>{class i{ngZone=v(_e);setInterval(e,t){return this.ngZone?this.ngZone.runOutsideAngular(()=>window.setInterval(()=>this.runInsideAngular(e),t)):window.setInterval(()=>e(),t)}setTimeout(e,t){return this.ngZone?this.ngZone.runOutsideAngular(()=>window.setTimeout(()=>this.runInsideAngular(e),t)):window.setTimeout(()=>e(),t)}runInsideAngular(e){this.ngZone?this.ngZone.run(()=>e()):e()}static \u0275fac=function(t){return new(t||i)};static \u0275prov=M({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),St=(()=>{class i{toastPackage=v(J);toastrService=v(A);appRef=v(ke);timeoutsService=v(ri);duplicatesCount;hideTime;width=ye(-1);state=ye("inactive");displayStyle=V(()=>this.state()==="inactive"?"none":void 0);message=V(()=>this.toastPackage.message);title=V(()=>this.toastPackage.title);options=rt(()=>this.toastPackage.config);originalTimeout=V(()=>this.toastPackage.config.timeOut);toastClasses=V(()=>`${this.toastPackage.toastType} ${this.toastPackage.config.toastClass}`);timeout;intervalId;afterActivateSubscription;manualClosedSubscription;timeoutResetSubscription;countDuplicateSubscription;constructor(){this.afterActivateSubscription=this.toastPackage.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.manualClosedSubscription=this.toastPackage.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.timeoutResetSubscription=this.toastPackage.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.countDuplicateSubscription=this.toastPackage.toastRef.countDuplicate().subscribe(e=>{this.duplicatesCount=e})}ngOnDestroy(){this.afterActivateSubscription.unsubscribe(),this.manualClosedSubscription.unsubscribe(),this.timeoutResetSubscription.unsubscribe(),this.countDuplicateSubscription.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){let e=this.options();this.state.set("active"),!(e.disableTimeOut===!0||e.disableTimeOut==="timeOut")&&e.timeOut&&(this.timeout=this.timeoutsService.setTimeout(()=>this.remove(),e.timeOut),this.hideTime=new Date().getTime()+e.timeOut,e.progressBar&&(this.intervalId=this.timeoutsService.setInterval(()=>this.updateProgress(),10)))}updateProgress(){let e=this.options();if(this.width()===0||this.width()===100||!e.timeOut)return;let t=new Date().getTime(),o=this.hideTime-t;this.width.set(o/e.timeOut*100),e.progressAnimation==="increasing"&&this.width.update(r=>100-r),this.width()<=0&&this.width.set(0),this.width()>=100&&this.width.set(100)}resetTimeout(){let e=this.options();clearTimeout(this.timeout),clearInterval(this.intervalId),this.state.set("active"),this.options.update(t=>j(y({},t),{timeOut:this.originalTimeout()})),this.timeout=this.timeoutsService.setTimeout(()=>this.remove(),this.originalTimeout()),this.hideTime=new Date().getTime()+(this.originalTimeout()||0),this.width.set(-1),e.progressBar&&(this.intervalId=this.timeoutsService.setInterval(()=>this.updateProgress(),10))}remove(){this.state()!=="removed"&&(clearTimeout(this.timeout),this.state.set("removed"),this.timeout=this.timeoutsService.setTimeout(()=>this.toastrService.remove(this.toastPackage.toastId)))}tapToast(){this.state()!=="removed"&&(this.toastPackage.triggerTap(),this.options().tapToDismiss&&this.remove())}stickAround(){this.state()!=="removed"&&this.options().disableTimeOut!=="extendedTimeOut"&&(clearTimeout(this.timeout),this.options.update(e=>j(y({},e),{timeOut:0})),this.hideTime=0,clearInterval(this.intervalId),this.width.set(0))}delayedHideToast(){let e=this.options();if(e.disableTimeOut===!0||e.disableTimeOut==="extendedTimeOut"||e.extendedTimeOut===0||this.state()==="removed")return;let t=e.extendedTimeOut;this.timeout=this.timeoutsService.setTimeout(()=>this.remove(),t),this.options.update(o=>j(y({},o),{timeOut:t})),this.hideTime=new Date().getTime()+(t||0),this.width.set(-1),e.progressBar&&(this.intervalId=this.timeoutsService.setInterval(()=>this.updateProgress(),10))}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=g({type:i,selectors:[["","toast-component",""]],hostVars:4,hostBindings:function(t,o){t&1&&k("mouseenter",function(){return o.stickAround()})("mouseleave",function(){return o.delayedHideToast()})("click",function(){return o.tapToast()}),t&2&&(D(o.toastClasses()),$("display",o.displayStyle()))},attrs:yt,decls:5,vars:5,consts:[["type","button","aria-label","Close",1,"toast-close-button"],[3,"class"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"class","innerHTML"],["role","alert",3,"class"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(t,o){if(t&1&&(we(0),p(1,Ut,3,0,"button",0),p(2,zt,3,5,"div",1),p(3,Wt,2,1),p(4,Yt,2,2,"div")),t&2){let r=Fe(o.options());a(),h(r.closeButton?1:-1),a(),h(o.title()?2:-1),a(),h(o.message()?3:-1),a(),h(r.progressBar?4:-1)}},encapsulation:2,changeDetection:0})}return i})(),ai=(()=>{class i extends St{params={easeTime:this.toastPackage.config.easeTime,easing:"ease-in"};elementRef=v(Ze);remove(){this.state()!=="removed"&&(clearTimeout(this.timeout),this.state.set("removed"),this.elementRef.nativeElement.classList.add("toast-out"),this.timeout=this.timeoutsService.setTimeout(()=>this.toastrService.remove(this.toastPackage.toastId),+this.params.easeTime))}static \u0275fac=(()=>{let e;return function(o){return(e||(e=ze(i)))(o||i)}})();static \u0275cmp=g({type:i,selectors:[["","toast-component",""]],hostVars:4,hostBindings:function(t,o){t&1&&Ye("toast-in"),t&2&&$("--animation-easing",o.params.easing)("--animation-duration",o.params.easeTime+"ms")},features:[We],attrs:yt,decls:5,vars:5,consts:[["type","button","aria-label","Close",1,"toast-close-button"],[3,"class"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"class","innerHTML"],["role","alert",3,"class"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(t,o){if(t&1&&(we(0),p(1,$t,3,0,"button",0),p(2,Kt,3,5,"div",1),p(3,ti,2,1),p(4,ii,2,2,"div")),t&2){let r=Fe(o.options());a(),h(r.closeButton?1:-1),a(),h(o.title()?2:-1),a(),h(o.message()?3:-1),a(),h(r.progressBar?4:-1)}},styles:[".toast-in[_nghost-%COMP%]{animation:_ngcontent-%COMP%_toast-animation var(--animation-duration) var(--animation-easing)}.toast-out[_nghost-%COMP%]{animation:_ngcontent-%COMP%_toast-animation var(--animation-duration) var(--animation-easing) reverse forwards}@keyframes _ngcontent-%COMP%_toast-animation{0%{opacity:0}to{opacity:1}}"],changeDetection:0})}return i})(),si=j(y({},bt),{toastComponent:ai}),ci=(i={})=>qe([{provide:kt,useValue:{default:si,config:i}}]),Qi=(()=>{class i{static forRoot(e={}){return{ngModule:i,providers:[ci(e)]}}static \u0275fac=function(t){return new(t||i)};static \u0275mod=L({type:i});static \u0275inj=B({})}return i})();var Wi=j(y({},bt),{toastComponent:St});function mi(i,n){if(i&1){let e=R();s(0,"div",0)(1,"div",6)(2,"h4"),l(3,"Shipping address"),c(),s(4,"button",7),k("click",function(){N(e);let o=u();return P(o.saveUserAdress())}),l(5," Save as default address "),c()(),s(6,"div",8)(7,"div",9),d(8,"app-text-input",10),c(),s(9,"div",9),d(10,"app-text-input",11),c(),s(11,"div",9),d(12,"app-text-input",12),c(),s(13,"div",9),d(14,"app-text-input",13),c(),s(15,"div",9),d(16,"app-text-input",14),c(),s(17,"div",9),d(18,"app-text-input",15),c()()()}if(i&2){let e,t=u();m("formGroup",t.checkoutForm),a(4),m("disabled",!((e=t.checkoutForm.get("addressForm"))!=null&&e.valid)||!((e=t.checkoutForm.get("addressForm"))!=null&&e.dirty)),a(4),m("label","First name"),a(2),m("label","Last name"),a(2),m("label","Street"),a(2),m("label","City"),a(2),m("label","Country"),a(2),m("label","Zip code")}}var Tt=(()=>{class i{constructor(e,t){this.accountService=e,this.toastr=t}saveUserAdress(){this.accountService.updateUserAddress(this.checkoutForm?.get("addressForm")?.value).subscribe({next:()=>{this.toastr.success("Address saved"),this.checkoutForm?.get("addressForm")?.reset(this.checkoutForm?.get("addressForm")?.value)}})}static{this.\u0275fac=function(t){return new(t||i)(f(se),f(A))}}static{this.\u0275cmp=g({type:i,selectors:[["app-checkout-address"]],inputs:{checkoutForm:"checkoutForm"},standalone:!1,decls:8,vars:2,consts:[[1,"mt-4",3,"formGroup"],[1,"d-flex","justify-content-between","flex-row","mb-5"],["routerLink","/basket",1,"btn","btn-outline-primary"],[1,"fa","fa-angle-left"],["cdkStepperNext","",1,"btn","btn-primary",3,"disabled"],[1,"fa","fa-angle-right"],[1,"d-flex-justify-content-between","align-items-center"],[1,"btn","btn-outline-success","mb-3",3,"click","disabled"],["formGroupName","addressForm",1,"row"],[1,"form-group","col-6"],["formControlName","firstName",3,"label"],["formControlName","lastName",3,"label"],["formControlName","street",3,"label"],["formControlName","city",3,"label"],["formControlName","country",3,"label"],["formControlName","zipCode",3,"label"]],template:function(t,o){if(t&1&&(p(0,mi,19,8,"div",0),s(1,"div",1)(2,"button",2),d(3,"i",3),l(4," Back to basket "),c(),s(5,"button",4),l(6," Go to delivery "),d(7,"i",5),c()()),t&2){let r;h(o.checkoutForm?0:-1),a(5),m("disabled",o.checkoutForm==null||(r=o.checkoutForm.get("addressForm"))==null?null:r.invalid)}},dependencies:[ae,H,G,z,q,U,ce,le],encapsulation:2})}}return i})();var me=(()=>{class i{constructor(e){this.http=e,this.baseUrl=ht.apiUrl}createOrder(e){return this.http.post(this.baseUrl+"orders",e)}getDeliveryMethods(){return this.http.get(this.baseUrl+"orders/deliveryMethods").pipe(He(e=>e.sort((t,o)=>o.price-t.price)))}static{this.\u0275fac=function(t){return new(t||i)(Ue(lt))}}static{this.\u0275prov=M({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function pi(i,n){if(i&1){let e=R();s(0,"div",7)(1,"input",8),k("click",function(){let o=N(e).$implicit,r=u(2);return P(r.setShippingPrice(o))}),c(),s(2,"label",9)(3,"strong"),l(4),ot(5,"currency"),c(),d(6,"br"),s(7,"span",10),l(8),c()()()}if(i&2){let e=n.$implicit;a(),m("value",ne(e.id))("id",ne(e.id)),a(),m("for",ne(e.id)),a(2),tt("",e.shortName," - ",nt(5,9,e.price)),a(4),oe(e.description)}}function hi(i,n){if(i&1&&(s(0,"div",0)(1,"div",6),Je(2,pi,9,11,"div",7,$e),c()()),i&2){let e=u();m("formGroup",e.checkoutForm),a(2),Ke(e.deliveryMethods)}}var wt=(()=>{class i{constructor(e,t){this.checkoutService=e,this.basketService=t,this.deliveryMethods=[]}ngOnInit(){this.checkoutService.getDeliveryMethods().subscribe({next:e=>this.deliveryMethods=e})}setShippingPrice(e){this.basketService.setShippingPrice(e)}static{this.\u0275fac=function(t){return new(t||i)(f(me),f(I))}}static{this.\u0275cmp=g({type:i,selectors:[["app-checkout-delivery"]],inputs:{checkoutForm:"checkoutForm"},standalone:!1,decls:8,vars:2,consts:[[1,"mt-4",3,"formGroup"],[1,"d-flex","justify-content-between","flex-row","mb-5"],["cdkStepperPrevious","",1,"btn","btn-outline-primary"],[1,"fa","fa-angle-left"],["cdkStepperNext","",1,"btn","btn-primary",3,"disabled"],[1,"fa","fa-angle-right"],["formGroupName","deliveryForm",1,"row"],[1,"col-6","form-group"],["type","radio","formControlName","deliveryMethod",1,"form-check-input",3,"click","value","id"],[1,"form-check-label","ms-2","mb-3",3,"for"],[1,"label-description"]],template:function(t,o){if(t&1&&(p(0,hi,4,1,"div",0),s(1,"div",1)(2,"button",2),d(3,"i",3),l(4," Back to address "),c(),s(5,"button",4),l(6," Go to review "),d(7,"i",5),c()()),t&2){let r;h(o.checkoutForm?0:-1),a(5),m("disabled",o.checkoutForm==null||(r=o.checkoutForm.get("deliveryForm"))==null?null:r.invalid)}},dependencies:[mt,ut,H,G,z,q,U,le,Z,st],encapsulation:2})}}return i})();var Ft=(()=>{class i{constructor(e,t){this.basketService=e,this.toastr=t}createPaymentIntent(){this.basketService.createPaymentIntent().subscribe({next:()=>{this.appStepper?.next()},error:e=>this.toastr.error(e.message)})}static{this.\u0275fac=function(t){return new(t||i)(f(I),f(A))}}static{this.\u0275cmp=g({type:i,selectors:[["app-checkout-review"]],inputs:{appStepper:"appStepper"},standalone:!1,decls:9,vars:1,consts:[[1,"mt-4"],[3,"isBasket"],[1,"d-flex","justify-content-between","flex-row","mb-5"],["cdkStepperPrevious","",1,"btn","btn-outline-primary"],[1,"fa","fa-angle-left"],[1,"btn","btn-primary",3,"click"],[1,"fa","fa-angle-right"]],template:function(t,o){t&1&&(s(0,"div",0),d(1,"app-basket-summary",1),c(),s(2,"div",2)(3,"button",3),d(4,"i",4),l(5," Back to delivery "),c(),s(6,"button",5),k("click",function(){return o.createPaymentIntent()}),l(7," Go to payment "),d(8,"i",6),c()()),t&2&&(a(),m("isBasket",!1))},dependencies:[Z,gt],encapsulation:2})}}return i})();function he(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?he=function(n){return typeof n}:he=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},he(i)}var Mt="clover",Ci=function(n){return n===3?"v3":n},Nt="https://js.stripe.com",gi="".concat(Nt,"/").concat(Mt,"/stripe.js"),_i=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,yi=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,Dt="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",bi=function(n){return _i.test(n)||yi.test(n)},ki=function(){for(var n=document.querySelectorAll('script[src^="'.concat(Nt,'"]')),e=0;e<n.length;e++){var t=n[e];if(bi(t.src))return t}return null},It=function(n){var e=n&&!n.advancedFraudSignals?"?advancedFraudSignals=false":"",t=document.createElement("script");t.src="".concat(gi).concat(e);var o=document.head||document.body;if(!o)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return o.appendChild(t),t},Si=function(n,e){!n||!n._registerWrapper||n._registerWrapper({name:"stripe-js",version:"8.7.0",startTime:e})},K=null,ue=null,pe=null,xi=function(n){return function(e){n(new Error("Failed to load Stripe.js",{cause:e}))}},Ti=function(n,e){return function(){window.Stripe?n(window.Stripe):e(new Error("Stripe.js not available"))}},Ei=function(n){return K!==null?K:(K=new Promise(function(e,t){if(typeof window>"u"||typeof document>"u"){e(null);return}if(window.Stripe&&n&&console.warn(Dt),window.Stripe){e(window.Stripe);return}try{var o=ki();if(o&&n)console.warn(Dt);else if(!o)o=It(n);else if(o&&pe!==null&&ue!==null){var r;o.removeEventListener("load",pe),o.removeEventListener("error",ue),(r=o.parentNode)===null||r===void 0||r.removeChild(o),o=It(n)}pe=Ti(e,t),ue=xi(t),o.addEventListener("load",pe),o.addEventListener("error",ue)}catch(C){t(C);return}}),K.catch(function(e){return K=null,Promise.reject(e)}))},wi=function(n,e,t){if(n===null)return null;var o=e[0];if(typeof o!="string")throw new Error("Expected publishable key to be of type string, got type ".concat(he(o)," instead."));var r=o.match(/^pk_test/),C=Ci(n.version),_=Mt;r&&C!==_&&console.warn("Stripe.js@".concat(C," was loaded on the page, but @stripe/stripe-js@").concat("8.7.0"," expected Stripe.js@").concat(_,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var S=n.apply(void 0,e);return Si(S,t),S},X,Pt=!1,Rt=function(){return X||(X=Ei(null).catch(function(n){return X=null,Promise.reject(n)}),X)};Promise.resolve().then(function(){return Rt()}).catch(function(i){Pt||console.warn(i)});var Ot=function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];Pt=!0;var o=Date.now();return Rt().then(function(r){return wi(r,e,o)})};var Fi=["cardNumber"],Di=["cardExpiry"],Ii=["cardCvc"];function Mi(i,n){if(i&1&&(s(0,"div",3)(1,"div",10)(2,"div",11),d(3,"app-text-input",12),c()(),s(4,"div",13)(5,"div",14)(6,"div",15),d(7,"div",16,0),s(9,"label"),l(10,"Card Number"),c(),s(11,"span",17),l(12),c()()(),s(13,"div",18)(14,"div",15),d(15,"div",16,1),s(17,"label"),l(18,"Card Expiry"),c()()(),s(19,"div",18)(20,"div",15),d(21,"div",16,2),s(23,"label"),l(24,"Card CVC"),c()()()()()),i&2){let e=u();m("formGroup",e.checkoutForm),a(3),m("label","Name on card"),a(9),oe(e.cardErrors)}}function Ni(i,n){i&1&&d(0,"i",9)}var At=(()=>{class i{constructor(e,t,o,r){this.basketService=e,this.checkoutService=t,this.toastr=o,this.router=r,this.stripe=null,this.cardNumberComplete=!1,this.cardExpiryComplete=!1,this.cardCvcComplete=!1,this.loading=!1}ngOnInit(){Ot("pk_test_51MuzseF7nFw8Tmn3ZzGP7uiL5wLfTD9e7KLGBcfxKQWaFQCVja4kKxjo0ENpYUFY69252EzsYQagfN3NH7RBwqez00FFInCBZn").then(e=>{this.stripe=e;let t=e?.elements();t&&(this.cardNumber=t.create("cardNumber"),this.cardNumber.mount(this.cardNumberElement?.nativeElement),this.cardNumber.on("change",o=>{this.cardNumberComplete=o.complete,o.error?this.cardErrors=o.error.message:this.cardErrors=null}),this.cardExpiry=t.create("cardExpiry"),this.cardExpiry.mount(this.cardExpiryElement?.nativeElement),this.cardExpiry.on("change",o=>{this.cardExpiryComplete=o.complete,o.error?this.cardErrors=o.error.message:this.cardErrors=null}),this.cardCvc=t.create("cardCvc"),this.cardCvc.mount(this.cardCvcElement?.nativeElement),this.cardCvc.on("change",o=>{this.cardCvcComplete=o.complete,o.error?this.cardErrors=o.error.message:this.cardErrors=null}))})}get paymentFormComplete(){return this.checkoutForm?.get("paymentForm")?.valid&&this.cardNumberComplete&&this.cardExpiryComplete&&this.cardCvcComplete}submitOrder(){return ee(this,null,function*(){this.loading=!0;let e=this.basketService.getCurrnetBasketValue();if(!e)throw new Error("cannot get basket");try{let t=yield this.createOrder(e),o=yield this.confirmPaymentWithStripe(e);if(o.paymentIntent){this.basketService.deleteBasket(e);let r={state:t};this.router.navigate(["checkout/success"],r)}else this.toastr.error(o.error.message)}catch(t){console.log(t),this.toastr.error(t.message)}finally{this.loading=!1}})}confirmPaymentWithStripe(e){return ee(this,null,function*(){if(!e)throw new Error("Basket is null");let t=this.stripe?.confirmCardPayment(e.clientSecret,{payment_method:{card:this.cardNumber,billing_details:{name:this.checkoutForm?.get("paymentForm")?.get("nameOnCard")?.value}}});if(!t)throw new Error("Problem attempting payment with Stripe");return t})}createOrder(e){return ee(this,null,function*(){if(!e)throw new Error("Basket is null");let t=this.getOrderToCreate(e);return Ve(this.checkoutService.createOrder(t))})}getOrderToCreate(e){let t=this.checkoutForm?.get("deliveryForm")?.get("deliveryMethod")?.value,o=this.checkoutForm?.get("addressForm")?.value;if(!t||!o)throw new Error("Problem with basket");return{basketId:e.id,deliveryMethodId:t,shipToAddress:o}}static{this.\u0275fac=function(t){return new(t||i)(f(I),f(me),f(A),f(re))}}static{this.\u0275cmp=g({type:i,selectors:[["app-checkout-payment"]],viewQuery:function(t,o){if(t&1&&Xe(Fi,5)(Di,5)(Ii,5),t&2){let r;te(r=ie())&&(o.cardNumberElement=r.first),te(r=ie())&&(o.cardExpiryElement=r.first),te(r=ie())&&(o.cardCvcElement=r.first)}},inputs:{checkoutForm:"checkoutForm"},standalone:!1,decls:9,vars:3,consts:[["cardNumber",""],["cardExpiry",""],["cardCvc",""],[1,"mt-4",3,"formGroup"],[1,"d-flex","justify-content-between","flex-row","mb-5"],["cdkStepperPrevious","",1,"btn","btn-outline-primary"],[1,"fa","fa-angle-left"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fa","fa-angle-right"],[1,"fa","fa-spinner","fa-spin"],[1,"row"],["formGroupName","paymentForm",1,"form-group","col-12"],["formControlName","nameOnCard",3,"label"],[1,"row","mb-3"],[1,"col-6"],[1,"form-floating"],[1,"form-control"],[1,"text-danger"],[1,"col-3"]],template:function(t,o){t&1&&(p(0,Mi,25,3,"div",3),s(1,"div",4)(2,"button",5),d(3,"i",6),l(4," Back to review "),c(),s(5,"button",7),k("click",function(){return o.submitOrder()}),l(6," Submit order "),d(7,"i",8),p(8,Ni,1,0,"i",9),c()()),t&2&&(h(o.checkoutForm?0:-1),a(5),m("disabled",o.loading||!o.paymentFormComplete),a(3),h(o.loading?8:-1))},dependencies:[H,G,z,q,U,ce,Z],encapsulation:2})}}return i})();var jt=(()=>{class i{constructor(e,t,o){this.fb=e,this.accountService=t,this.basketService=o,this.checkoutForm=this.fb.group({addressForm:this.fb.group({firstName:["",E.required],lastName:["",E.required],street:["",E.required],city:["",E.required],country:["",E.required],zipCode:["",E.required]}),deliveryForm:this.fb.group({deliveryMethod:["",E.required]}),paymentForm:this.fb.group({nameOnCard:["",E.required]})})}ngOnInit(){this.getAddressFormValues(),this.getDeliveryMethodValue()}getAddressFormValues(){this.accountService.getUserAddress().subscribe({next:e=>{e&&this.checkoutForm.get("addressForm")?.patchValue(e)}})}getDeliveryMethodValue(){let e=this.basketService.getCurrnetBasketValue();e&&e.deliveryMethodId&&this.checkoutForm.get("deliveryForm")?.get("deliveryMethod")?.patchValue(e.deliveryMethodId.toString())}static{this.\u0275fac=function(t){return new(t||i)(f(pt),f(se),f(I))}}static{this.\u0275cmp=g({type:i,selectors:[["app-checkout"]],standalone:!1,decls:15,vars:11,consts:[["appStepper",""],[1,"container","mt-5"],[1,"row"],[1,"col-8"],[3,"label","completed"],[3,"checkoutForm"],[3,"label"],[3,"appStepper"],[1,"col-4"]],template:function(t,o){if(t&1&&(s(0,"div",1)(1,"div",2)(2,"div",3)(3,"app-stepper",null,0)(5,"cdk-step",4),d(6,"app-checkout-address",5),c(),s(7,"cdk-step",4),d(8,"app-checkout-delivery",5),c(),s(9,"cdk-step",6),d(10,"app-checkout-review",7),c(),s(11,"cdk-step",4),d(12,"app-checkout-payment",5),c()()(),s(13,"div",8),d(14,"app-order-totals"),c()()()),t&2){let r,C,_,S=et(4);a(5),m("label","Address")("completed",(r=o.checkoutForm.get("addressForm"))==null?null:r.valid),a(),m("checkoutForm",o.checkoutForm),a(),m("label","Delivery")("completed",(C=o.checkoutForm.get("deliveryForm"))==null?null:C.valid),a(),m("checkoutForm",o.checkoutForm),a(),m("label","Review"),a(),m("appStepper",S),a(),m("label","Payment")("completed",(_=o.checkoutForm.get("paymentForm"))==null?null:_.valid),a(),m("checkoutForm",o.checkoutForm)}},dependencies:[ft,Ct,vt,Tt,wt,Ft,At],encapsulation:2})}}return i})();function Ri(i,n){if(i&1&&(s(0,"button",3),l(1,"View your order"),c()),i&2){let e=u();m("routerLink",it("/orders/",e.order.id))}}function Oi(i,n){i&1&&(s(0,"button",4),l(1,"View your orders"),c())}var Bt=(()=>{class i{constructor(e){this.router=e;let t=this.router.getCurrentNavigation();this.order=t?.extras?.state}static{this.\u0275fac=function(t){return new(t||i)(f(re))}}static{this.\u0275cmp=g({type:i,selectors:[["app-checkout-success"]],standalone:!1,decls:9,vars:2,consts:[[1,"container","mt-5"],[1,"fa","fa-check-circle","fa-5x",2,"color","green"],[1,"mb-4"],[1,"btn","btn-outline-success",3,"routerLink"],["routerLink","/orders",1,"btn","btn-outline-success"]],template:function(t,o){t&1&&(s(0,"div",0)(1,"div"),d(2,"i",1),c(),s(3,"h2"),l(4,"Thank you. Your order is confirmed"),c(),s(5,"p",2),l(6,"Your order has not shipped"),c(),p(7,Ri,2,2,"button",3),p(8,Oi,2,0,"button",4),c()),t&2&&(a(7),h(o.order?7:-1),a(),h(o.order?-1:8))},dependencies:[ae],encapsulation:2})}}return i})();var Ai=[{path:"",component:jt},{path:"success",component:Bt}],Lt=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=L({type:i})}static{this.\u0275inj=B({imports:[De.forChild(Ai),De]})}}return i})();var No=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=L({type:i})}static{this.\u0275inj=B({imports:[ct,Lt,_t]})}}return i})();export{A as a,Qi as b,No as c};
