import{P as at,m as et,n as it,r as ot,s as rt,t as D}from"./chunk-HDRMHIVV.js";import{$a as G,$b as nt,Aa as S,Ba as C,Ca as I,Da as T,Ea as M,Fa as h,Ga as o,H as $,Ha as r,I as V,Ia as y,Ib as N,Jb as K,K as H,N as m,O as l,Pb as W,Ra as f,Rb as X,Ta as d,Va as p,Vb as Z,Yb as tt,Za as L,_a as Y,_b as U,a as R,cb as A,eb as s,fa as O,fb as g,ga as a,gb as P,lb as x,ma as _,mb as J,o as w,oa as b,pa as q,r as E,sb as j,tb as z,y as Q}from"./chunk-2X7YOW7U.js";var k=class{constructor(){this.brand="",this.category="",this.sort="name",this.pageNumber=1,this.pageSize=6,this.search=""}};var F=(()=>{class i{constructor(t){this.http=t,this.baseUrl=nt.apiUrl,this.products=[],this.brands=[],this.categories=[],this.shopParams=new k,this.productCache=new Map}getProducts(t=!0){if(t||(this.productCache=new Map),this.productCache.size>0&&t&&this.productCache.has(Object.values(this.shopParams).join("-"))&&(this.pagination=this.productCache.get(Object.values(this.shopParams).join("-")),this.pagination))return w(this.pagination);let e=new W;return e=e.append("sort",this.shopParams.sort),e=e.append("pageIndex",this.shopParams.pageNumber),e=e.append("pageSize",this.shopParams.pageSize),this.shopParams.pageSize>0&&(e=e.append("pagesize",this.shopParams.pageSize)),this.shopParams.category.length>0&&this.shopParams.category!="All"&&(e=e.append("category",this.shopParams.category)),this.shopParams.brand.length>0&&this.shopParams.brand!="All"&&(e=e.append("brand",this.shopParams.brand)),this.shopParams.search&&(e=e.append("search",this.shopParams.search)),this.http.get(this.baseUrl+"products",{params:e}).pipe(E(n=>(this.productCache.set(Object.values(this.shopParams).join("-"),n),this.pagination=n,n)))}setShopParams(t){this.shopParams=t}getShopParams(){return this.shopParams}getProduct(t){let e=[...this.productCache.values()].reduce((n,c)=>R(R({},n),c.data.find(v=>v.id===t)),{});return Object.keys(e).length!==0?w(e):this.http.get(this.baseUrl+"products/"+t)}getTypes(){return this.categories.length>0?w(this.categories):this.http.get(this.baseUrl+"products/categories").pipe(E(t=>this.categories=t))}getBrands(){return this.brands.length>0?w(this.brands):this.http.get(this.baseUrl+"products/brands").pipe(E(t=>this.brands=t))}static{this.\u0275fac=function(e){return new(e||i)(H(X))}}static{this.\u0275prov=$({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function ft(i,u){if(i&1){let t=f();o(0,"div",0)(1,"div",1),y(2,"img",2),o(3,"div",3)(4,"button",4),d("click",function(){m(t);let n=p();return l(n.addItemToBasket())}),s(5,"Buy"),r(),o(6,"button",5),s(7,"View"),r()()(),o(8,"div",6)(9,"a",7)(10,"h6",8),s(11),r()(),o(12,"span",9),s(13),j(14,"currency"),r()()()}if(i&2){let t=p();a(2),h("src",x(t.product.thumbnail),O)("alt",x(t.product.title)),a(4),h("routerLink",J("/shop/",t.product.id)),a(5),P(" ",t.product.title," "),a(2),g(z(14,8,t.product.price))}}var ct=(()=>{class i{constructor(t){this.basketService=t}addItemToBasket(){this.product&&this.basketService.addItemToBasket(this.product)}static{this.\u0275fac=function(e){return new(e||i)(_(D))}}static{this.\u0275cmp=b({type:i,selectors:[["app-product-item"]],inputs:{product:"product"},standalone:!1,decls:1,vars:1,consts:[[1,"card","h-100","shadow-sm"],[1,"image","position-relative",2,"cursor","pointer"],[1,"img-fluid","bg-info","img-same-size",3,"src","alt"],[1,"d-flex","align-items-center","justify-content-center","hover-overlay"],[1,"btn","btn-primary","me-2",3,"click"],[1,"btn","btn-primary",3,"routerLink"],[1,"card-body","d-flex","flex-column"],["href","",1,"text-decoration-none"],[1,"text-uppercase"],[1,"mb-2"]],template:function(e,n){e&1&&S(0,ft,15,10,"div",0),e&2&&C(n.product?0:-1)},dependencies:[tt,N],styles:[".img-same-size[_ngcontent-%COMP%]{height:150px}.btn[_ngcontent-%COMP%]{width:30%;height:40px}.image[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover{opacity:1}.image[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover   button[_ngcontent-%COMP%]{transform:none;opacity:1}.hover-overlay[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0;background:#ffffff80;opacity:0;transition:all .5s}.hover-overlay[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{z-index:1000;transition:all .5s}.hover-overlay[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-of-type{transform:translate(-20px)}.hover-overlay[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-of-type{transform:translate(20px)}"]})}}return i})();var vt=["search"];function St(i,u){if(i&1&&(o(0,"option",6),s(1),r()),i&2){let t=u.$implicit,e=p();h("selected",e.shopParams.sort===t.value)("value",t.value),a(),P(" ",t.name," ")}}function Ct(i,u){if(i&1){let t=f();o(0,"li",19),d("click",function(){let n=m(t).$implicit,c=p();return l(c.onTypeSelected(n))}),s(1),r()}if(i&2){let t=u.$implicit,e=p();A("active",t===e.shopParams.category),h("value",t),a(),g(t)}}function yt(i,u){if(i&1){let t=f();o(0,"li",19),d("click",function(){let n=m(t).$implicit,c=p();return l(c.onBrandSelected(n))}),s(1),r()}if(i&2){let t=u.$implicit,e=p();A("active",t===e.shopParams.brand),h("value",t),a(),g(t)}}function bt(i,u){if(i&1&&(o(0,"div",17),y(1,"app-product-item",20),r()),i&2){let t=u.$implicit;a(),h("product",t)}}function Pt(i,u){if(i&1){let t=f();o(0,"div",18)(1,"app-pager",21),d("pageChanged",function(n){m(t);let c=p();return l(c.onPageChanged(n))}),r()()}if(i&2){let t=p();a(),h("totalCount",t.totalCount)("pageSize",t.shopParams.pageSize)("pageNumber",t.shopParams.pageNumber)}}var pt=(()=>{class i{constructor(t){this.shopService=t,this.products=[],this.categories=[],this.brands=[],this.totalCount=0,this.sortOptions=[{name:"Alphabetical",value:"name"},{name:"Price low to high",value:"priceAsc"},{name:"Price High to low",value:"priceDesc"}],this.shopParams=t.getShopParams()}ngOnInit(){this.getProducts(),this.getCategories(),this.getBrands()}getProducts(){this.shopService.getProducts().subscribe({next:t=>{this.products=t.data,this.totalCount=t.count},error:t=>console.log(t)})}getCategories(){this.shopService.getTypes().subscribe({next:t=>this.categories=["All",...t],error:t=>console.log(t)})}getBrands(){this.shopService.getBrands().subscribe({next:t=>this.brands=["All",...t],error:t=>console.log(t)})}onTypeSelected(t){let e=this.shopService.getShopParams();e.category=t,e.pageNumber=1,this.shopService.setShopParams(e),this.shopParams=e,this.getProducts()}onBrandSelected(t){let e=this.shopService.getShopParams();e.brand=t,e.pageNumber=1,this.shopService.setShopParams(e),this.shopParams=e,this.getProducts()}onSortSelected(t){let e=this.shopService.getShopParams();e.sort=t.target.value,this.shopService.setShopParams(e),this.shopParams=e,this.getProducts()}onPageChanged(t){let e=this.shopService.getShopParams();e.pageNumber!==t&&(e.pageNumber=t,this.shopService.setShopParams(e),this.shopParams=e,this.getProducts())}onSearch(){let t=this.shopService.getShopParams();t.search=this.searchTerm?.nativeElement.value,t.pageNumber=1,this.shopService.setShopParams(t),this.shopParams=t,this.getProducts()}onReset(){this.searchTerm&&(this.searchTerm.nativeElement.value=""),this.shopParams=new k,this.shopService.setShopParams(this.shopParams),this.getProducts()}static{this.\u0275fac=function(e){return new(e||i)(_(F))}}static{this.\u0275cmp=b({type:i,selectors:[["app-shop"]],viewQuery:function(e,n){if(e&1&&L(vt,5),e&2){let c;Y(c=G())&&(n.searchTerm=c.first)}},standalone:!1,decls:32,vars:4,consts:[["search",""],[1,"container"],[1,"row"],[1,"col-3"],[1,"text-warning","ms-3"],["name","","id","",1,"form-select","mb-4",3,"change"],[3,"selected","value"],[1,"list-group","my-3"],[1,"list-group-item",3,"active","value"],[1,"col-9"],[1,"d-flex","justify-content-between","align-items-center","pb-2"],[3,"totalCount","pageNumber","pageSize"],[1,"d-flex","mt-2"],["type","text","placeholder","Search",1,"form-control","me-2",3,"keyup.enter"],[1,"btn","btn-outline-primary","mx-2",3,"click"],[1,"btn","btn-outline-success",3,"click"],[1,"row","row-cols-3","g-3","mb-4"],[1,"col"],[1,"d-flex","justify-content-center"],[1,"list-group-item",3,"click","value"],[3,"product"],[3,"pageChanged","totalCount","pageSize","pageNumber"]],template:function(e,n){if(e&1){let c=f();o(0,"div",1)(1,"div",2)(2,"section",3)(3,"h5",4),s(4,"Sort"),r(),o(5,"select",5),d("change",function(dt){return m(c),l(n.onSortSelected(dt))}),T(6,St,2,3,"option",6,I),r(),o(8,"h5",4),s(9,"Types"),r(),o(10,"ul",7),T(11,Ct,2,4,"li",8,I),r(),o(13,"h5",4),s(14,"Brands"),r(),o(15,"ul",7),T(16,yt,2,4,"li",8,I),r()(),o(18,"section",9)(19,"div",10),y(20,"app-paging-header",11),o(21,"div",12)(22,"input",13,0),d("keyup.enter",function(){return m(c),l(n.onSearch())}),r(),o(24,"button",14),d("click",function(){return m(c),l(n.onSearch())}),s(25,"Search"),r(),o(26,"button",15),d("click",function(){return m(c),l(n.onReset())}),s(27,"Reset"),r()()(),o(28,"div",16),T(29,bt,2,1,"div",17,I),r(),S(31,Pt,2,3,"div",18),r()()()}e&2&&(a(6),M(n.sortOptions),a(5),M(n.categories),a(5),M(n.brands),a(4),h("totalCount",n.totalCount)("pageNumber",n.shopParams.pageNumber)("pageSize",n.shopParams.pageSize),a(9),M(n.products),a(2),C(n.totalCount>0?31:-1))},dependencies:[ot,rt,et,it,ct],styles:[".list-group-item[_ngcontent-%COMP%]{cursor:pointer;border:none;padding:10px 20px;font-size:1.1em}.list-group-item.active[_ngcontent-%COMP%]{border-radius:10px}.list-group-item[_ngcontent-%COMP%]:not(.active):hover{color:#fff;background-color:#e95420b3;border-radius:10px}"]})}}return i})();function xt(i,u){if(i&1&&(o(0,"h5",6),s(1),r()),i&2){let t=p(2);a(),P(" You have ",t.quantityInBasket," of this product in your basket ")}}function kt(i,u){if(i&1){let t=f();o(0,"div",1)(1,"div",2),y(2,"img",3),r(),o(3,"div",4)(4,"h2"),s(5),r(),o(6,"p",5),s(7),j(8,"currency"),r(),S(9,xt,2,1,"h5",6),o(10,"div",7)(11,"i",8),d("click",function(){m(t);let n=p();return l(n.decrementQuantity())}),r(),o(12,"span",9),s(13),r(),o(14,"i",10),d("click",function(){m(t);let n=p();return l(n.incrementQuantity())}),r(),o(15,"button",11),d("click",function(){m(t);let n=p();return l(n.updateBasket())}),s(16),r()(),o(17,"div",12)(18,"h4"),s(19,"Description"),r(),o(20,"p"),s(21),r()()()()}if(i&2){let t=p();a(2),h("src",x(t.images[0]),O)("alt",x(t.product.title)),a(3),g(t.product.title),a(2),g(z(8,11,t.product.price)),a(2),C(t.quantityInBasket>0?9:-1),a(4),g(t.quantity),a(2),h("disabled",t.quantity===t.quantityInBasket),a(),g(t.buttonText),a(5),g(t.product.description)}}var mt=(()=>{class i{constructor(t,e,n){this.shopService=t,this.activatedRoute=e,this.basketService=n,this.images=[],this.quantity=1,this.quantityInBasket=0}ngOnInit(){this.loadProduct()}loadProduct(){let t=this.activatedRoute.snapshot.paramMap.get("id");t&&this.shopService.getProduct(+t).subscribe({next:e=>{this.product=e,this.product.productImages.length==0?this.images[0]=this.product.thumbnail:this.images=this.product.productImages,this.basketService.basketSource$.pipe(Q(1)).subscribe({next:n=>{let c=n?.items.find(v=>v.id===+t);c&&(this.quantity=c.quantity,this.quantityInBasket=c.quantity)}})}})}incrementQuantity(){this.quantity++}decrementQuantity(){this.quantity>1&&this.quantity--}updateBasket(){if(this.product)if(this.quantity>this.quantityInBasket){let t=this.quantity-this.quantityInBasket;this.quantityInBasket+=t,this.basketService.addItemToBasket(this.product,t)}else{let t=this.quantityInBasket-this.quantity;this.quantityInBasket-=t,this.basketService.removeItemFromBasket(this.product.id,t)}}get buttonText(){return this.quantityInBasket===0?"Add to basket":"Update basket"}static{this.\u0275fac=function(e){return new(e||i)(_(F),_(Z),_(D))}}static{this.\u0275cmp=b({type:i,selectors:[["app-product-details"]],standalone:!1,decls:2,vars:1,consts:[[1,"container"],[1,"row"],[1,"col-6"],[1,"w-100",3,"src","alt"],[1,"col-6","mt-5"],[2,"font-size","2em"],[1,"text-primary","mb-3"],[1,"d-flex","justify-content-start","align-items-center"],[1,"fa","fa-minus-circle","text-warning","me-2",2,"cursor","pointer","font-size","2em",3,"click"],[1,"font-weight-bold",2,"font-size","1.5em"],[1,"fa","fa-plus-circle","text-warning","ms-2",2,"cursor","pointer","font-size","2em",3,"click"],[1,"btn","btn-outline-primary","ms-4",3,"click","disabled"],[1,"row","mt-4"]],template:function(e,n){e&1&&(o(0,"div",0),S(1,kt,22,13,"div",1),r()),e&2&&(a(),C(n.product?1:-1))},dependencies:[N],encapsulation:2})}}return i})();var wt=[{path:"",component:pt},{path:":id",component:mt}],lt=(()=>{class i{static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275mod=q({type:i})}static{this.\u0275inj=V({imports:[U.forChild(wt),U]})}}return i})();var te=(()=>{class i{static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275mod=q({type:i})}static{this.\u0275inj=V({imports:[K,at,lt]})}}return i})();export{te as a};
